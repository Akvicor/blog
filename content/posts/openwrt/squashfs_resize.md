---
title: "squashfs镜像扩容"
date: 2022-11-16 22:48:59 +08:00
draft: false
categories: [OpenWrt]
tags: []
card: false
weight: 0
---

此方法仅适合刚把镜像写入磁盘还未启动以及还未将镜像写入磁盘这两种情况，一旦系统启动，squashfs分区大小就已经确定了，如果要更改只能使用losetup挂载并执行resize.f2fs扩展大小。

## 1. 扩展镜像文件

如果要修改的是IMG文件，需要先使用dd命令扩展文件的大小，如果IMG已经写入了磁盘则直接从第2步开始

```shell
dd if=/dev/zero bs=1M count=1024 >> openwrt-squashfs.img
```

## 2. 使用fdisk编辑

输入命令 `fdisk openwrt-squashfs.img` 并按回车进入分区状态，如果IMG已经写入了磁盘则将文件路径改为磁盘路径即可，例如`fdisk /dev/sda`

1. 输入`p`并按回车，显示当前分区表
2. 记下第二个分区的起始位置
3. 输入`d`并按2次回车删除第二分区
4. 输入`n`并按3次回车创建新分区
5. 输入刚才记下的起始位置并按回车
6. 输入新分区的大小并按回车，例如`+1G`为分配1G大小的分区，注意分配的大小不可超过上面dd所扩展的大小或磁盘大小，如果要使用所有未使用的空间直接留空按回车即可
7. 输入`n`并按回车保留当前squashfs分区的签名
8. 再次输入`p`并按回车确认分区是否正确，如果不正确输入`q`并按回车退出重新开始分区
9. 输入`w`并按回车保存更改

修改完成后将IMG文件直接写入磁盘并重启即可，如果IMG已经写入了磁盘则直接重启系统开始自动安装

